{% extends 'substitute/base.html'%}
{% block heart %}
{% load static %}
<style type="text/css">
    #aliment-area
    {
        background: url('{{ substitut.url_image}}');
        background-position: center;
    }

</style>
<div class="container-fluid" id="aliment-area">
    <div class="row">
        <div class="col-12"><br/></div>
        <div class="col-12 h1 d-flex justify-content-center" >
            <a href="{{ substitut.url }}" class="col-3 btn btn-lg btn-create-account btn-block text-uppercase bg-butter "> {{ substitut.name }}</a>
        </div>
        <div class="col-12"><br/></div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-12"> <br/></div>
                <div class="col-12 h2">
                    <img src="{{ substitut.url_image}}">
                    <a class="chocolate-text " style="text-decoration:none" href="{% url 'substitute:aliment' s_id=substitut.id p_id=produit.id u_id=utilisateur_id  %}"></a>
                </div>
        <div class="col-12 h2 d-flex justify-content-center chocolate-text">Marque : {{ substitut.brand|upper }}</div>
        <div class="col-12 h2 d-flex justify-content-center chocolate-text">Produit : {{ substitut.name }}</div>
        <div class="col-12 h2 d-flex justify-content-center chocolate-text">Magasin(s) : {{ substitut.store }}</div>
        <div class="col-12 h2 d-flex justify-content-center chocolate-text">Lieu(x) de vente : {{ substitut.purchase_places }}</div>
        <div class="col-12 h2 d-flex justify-content-center chocolate-text"> </div>
        <div class="col-12 h2 d-flex justify-content-center chocolate-text"> </div>
        <div class="col-12 h2 d-flex justify-content-center chocolate-text"> </div>
        <div class="col-12 h2 d-flex justify-content-center chocolate-text"> </div>
        <div class="col-6 d-flex justify-content-center underline-text h3">Nutriscore abCde</div>
        <div class="col-6 d-flex justify-content-center underline-text h3">Rep√®res nutritionnels pour 100g</div>
        <div class="col-6 d-flex justify-content-center  h3" style="align-items:center">
            <div class="col-6 d-flex justify-content-center  h3" style="align-items:center">
                <img src="{{ substitut_nutriscore }}" alt="Nutriscore"></div>
            </div>
            <div class="col-6 d-flex justify-content-center h3">
                <div class="col-12"><img src="{{ substitut.image_nutriments }}"></div>
            </div>
            <div class="col-6 d-flex justify-content-center h3"></div>
            <div class="col-6 d-flex justify-content-center underline-text h3">Energie</div>
            <div class="col-6 d-flex justify-content-center h3"></div>
            <div class="col-6 d-flex justify-content-center h3">{{ substitut.energy_kj }} {{ substitut.energy_kj_unit }} <br/>{{ substitut.energy_kcal }} {{ substitut.energy_kcal_unit }}</div>
            <div class="col-12"> <br/></div>
<!---------------------------------------------------------------------------------------------------------------------------------------->
<div class="container-fluid">
    <div class="row" id="gmap">
        <div class="col-12">Les Points de ventes</div>
        <div class="col-12"></div>
        <div class="col-4">
            <div><img src="{% static 'substitute/png/shop.png' %}" height="200" width="200" alt="Shop"></div>
        </div>
        <div class="col-4 border" id="gmap-square">
            <div id="gmap-window"></div>
            <!--<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDzIiQpQvRg5ozL9qqrGn3-8mexYTtD2fY&callback=initMap&v=weekly"></script>-->
            <!----------------------------------------------->
            <!--<script defer async src="https://maps.googleapis.com/maps/api/js?key={{ gmap_key }}&callback=initMap&v=weekly"></script>-->
            <!----------------------------------------------->
        </div>
        <div class="col-4">
            <div><img src="{% static 'substitute/png/countries.png' %}" height="200" width="200" alt="Countries"></div>
        </div>
    </div>
</div>
<!---------------------------------------------------------------------------------------------------------------------------------------->
            <div class="col-12"> <br/></div>
            <div class="col-12 h3">
                <form method="POST">
                    {% csrf_token %}
                    {% if request.user.is_authenticated %}
                    <a href="{% url 'substitute:save' p_id=produit.id s_id=substitut.id u_id=utilisateur_id %}">
                        <img src="{% static 'substitute/png/blue_save.png' %}" height="200" width="200" alt="Disquette - sauvegarde">
                        <div class="col-12 h3">Sauvegarder</div>
                    </a>
                    {% else %}
                    <a href="{% url 'substitute:login' %}">
                        <img src="{% static 'substitute/png/blue_save.png' %}" height="200" width="200" alt="Disquette - sauvegarde">
                        <div class="col-12 h3">Sauvegarder</div>
                    </a>
                    {% endif %}
                </form>
            </div>
            <form class="col-12 d-flex justify-content-center">
                <a href="{{ substitut.url }}" class="col-3 btn btn-lg btn-create-account btn-block text-uppercase "> Voir les fiches d'OpenFoodFacts !</a>
            </form>
            <div class="col-12"> <br/></div>
    </div>
</div>
<!--<script type="text/javascript" src="{% static 'substitute/js/gmap.js' %}"></script>-->
<!--<script>
//--------------------------------------------------
let map;

function initMap() {
  const map = new google.maps.Map(document.getElementById("gmap-window"), {
    //center: { lat: {{ lat }}, lng: {{ lng }} },
    center: { lat: -28.024, lng: 140.887 },
    zoom: 3,
  });
    marker = new google.maps.Marker(
  {
      //position: { lat: {{ lat }}, lng: {{ lng }} },
      position: { lat: -28.024, lng: 140.887 },
      map: map,
      icon: '{% static 'substitute/png/gmap_count.png' %}'
  });

}
//--------------------------------------------------
</script>-->
<script>
    function initMap() {
  const map = new google.maps.Map(document.getElementById("gmap-window"), {
    zoom: 5,
    //center: { lat: 46, lng: 2 },
    center: { lat: {{ gmap_average.av_lat }}, lng: {{ gmap_average.av_lng }} },
  });


 //--------------------------------------------------

 //     bubble = new google.maps.Marker(
 // {
 //     //position: { lat: {{ lat }}, lng: {{ lng }} },
 //     position: { lat: 45.7638871, lng: 4.8686548 },
 //     map: map,
 //     icon: '{% static 'substitute/png/gmap_count.png' %}'
 // });

  //bubble.setPlace({
  //position: {lat: 45.7638871, lng: 4.8686548},
  //placeId: "ChIJ-QGN64Dq9EcRdmkI1YA-5fU"
  //});

 //--------------------------------------------------

  const labels = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

  const markers = locations.map((location, i) => {
    return new google.maps.Marker({
      position: location,
      label: labels[i % labels.length],
    });
  });

  new MarkerClusterer(map, markers, {
    imagePath:
      "{% static 'substitute/png/m/m' %}",
  });
}
const locations = [
    {% for k, v in gmap_markers.items %}
     { lat:{{v.lat }}, lng:{{ v.lng }} },
    {% endfor %}
];
</script>
<script src="https://unpkg.com/@googlemaps/markerclustererplus/dist/index.min.js"></script>
{% endblock %}